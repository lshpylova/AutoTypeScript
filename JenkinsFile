pipeline {
    agent any 
    stages {
        stage('Build') {            
            steps {
                script {
                    def img = 'node:18-alpine'
                    // Запуск контейнера и сохранение его ID
                    def containerId = docker.image(img).run('-p 80:80')
                    
                    try {
                        sh '''
                        ls -la
                        node --version
                        npm --version
                        npm ci
                        npm run build
                        ls -la
                        '''
                    } finally {
                        // Остановка и удаление контейнера после выполнения
                        sh "docker stop ${containerId}"
                        sh "docker rm ${containerId}"
                    }
                }
            }
        }
    }
}